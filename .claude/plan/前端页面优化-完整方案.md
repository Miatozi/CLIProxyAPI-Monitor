# å‰ç«¯é¡µé¢ä¼˜åŒ– - å®Œæ•´å®æ–½æ–¹æ¡ˆ (A + B)

## æ‰§è¡Œæ—¶é—´
2026-01-15

## ç›®æ ‡
å…¨é¢ä¼˜åŒ–å‰ç«¯é¡µé¢è¡¨ç°å½¢å¼ï¼ŒåŒ…æ‹¬è§†è§‰è®¾è®¡ã€äº¤äº’ä½“éªŒã€æ€§èƒ½ä¼˜åŒ–ï¼Œåˆ†ä¸¤é˜¶æ®µæ‰§è¡Œã€‚

## ä¼˜åŒ–ç»´åº¦
- âœ… è§†è§‰è®¾è®¡ä¸ç¾è§‚åº¦
- âœ… äº¤äº’ä½“éªŒä¸åŠ¨æ•ˆ
- âœ… æ€§èƒ½ä¸åŠ è½½é€Ÿåº¦
- âœ… å…¨éƒ¨é¡µé¢æ•´ä½“ä¼˜åŒ–

---

## ğŸ”· é˜¶æ®µ 1ï¼šç²¾è‡´æ‰“ç£¨ï¼ˆè§†è§‰ä¸å®¢æˆ·ç«¯æ€§èƒ½ï¼‰

**ç›®æ ‡**: ç«‹å³æå‡è§†è§‰æ•ˆæœå’Œæ„ŸçŸ¥æ€§èƒ½ï¼Œæ— éœ€æ”¹å˜æ ¸å¿ƒæ•°æ®æ¶æ„

### 1.1 è§†è§‰æ‰“ç£¨ï¼ˆç»ç’ƒæ€ä¸æ·±åº¦ï¼‰

**æ ·å¼ç­–ç•¥**:
- èƒŒæ™¯ï¼šä»å¹³é¢ `bg-slate-950` è½¬ä¸ºåˆ†å±‚æ·±åº¦ç³»ç»Ÿ
- è¡¨é¢ï¼šå¡ç‰‡å’Œå¯¼èˆªä½¿ç”¨åŠé€æ˜èƒŒæ™¯ + èƒŒæ™¯æ¨¡ç³Š
- å­—ä½“ï¼šæ•°æ®æ˜¾ç¤ºå¼ºåˆ¶ä½¿ç”¨ `tabular-nums` é˜²æ­¢å¸ƒå±€è·³åŠ¨

**ä¿®æ”¹æ–‡ä»¶**:
- `app/globals.css` - æ·»åŠ ç»ç’ƒæ•ˆæœ CSS å˜é‡å’Œæ¸å˜
- `app/components/Sidebar.tsx` - æ›´æ–°ä¸ºåŠé€æ˜ç»ç’ƒèƒŒæ™¯
- `app/components/MobileNav.tsx` - åº”ç”¨ç»ç’ƒæ•ˆæœ
- `app/dashboard/components/StatsCard.tsx` - åº”ç”¨ç»ç’ƒæ ·å¼å’Œæ¸å˜è¾¹æ¡†
- `app/layout.tsx` - æ·»åŠ å…¨å±€èƒŒæ™¯æ¸å˜ç½‘æ ¼

**æ–°å¢æ ·å¼**:
```css
:root {
  --glass-bg: rgba(15, 23, 42, 0.6);
  --glass-border: rgba(255, 255, 255, 0.08);
  --glass-blur: 12px;
}
.glass-panel {
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur));
  border: 1px solid var(--glass-border);
}
```

### 1.2 äº¤äº’ä¸åŠ è½½ï¼ˆéª¨æ¶å±ï¼‰

**æ–°å¢ç»„ä»¶** (`app/components/ui/`):
- `Skeleton.tsx` - åŸºç¡€è„‰å†²æ•ˆæœ
- `CardSkeleton.tsx` - ç»Ÿè®¡å¡ç‰‡å ä½ç¬¦
- `ChartSkeleton.tsx` - å¤§å‹å›¾è¡¨åŒºåŸŸå ä½ç¬¦

**é›†æˆä½ç½®**:
- `app/page.tsx` - åŠ è½½æ—¶æ˜¾ç¤º `CardSkeleton` ç½‘æ ¼
- `app/explore/page.tsx` - æ•°æ®è·å–æœŸé—´æ˜¾ç¤ºå›¾è¡¨å ä½ç¬¦

### 1.3 ä»£ç åˆ†å‰²ï¼ˆæ‡’åŠ è½½ï¼‰

**æå–ç»„ä»¶** (`app/dashboard/components/`):
1. `TrendChart.tsx` - æ—¥ç”¨é‡è¶‹åŠ¿å›¾ï¼ˆLineChartï¼‰
2. `HourlyBarChart.tsx` - å°æ—¶è´Ÿè½½å›¾ï¼ˆBar/AreaChartï¼‰
3. `ModelDistributionPie.tsx` - æ¨¡å‹è´¹ç”¨é¥¼å›¾ï¼ˆPieChartï¼‰
4. `CostTable.tsx` - åº•éƒ¨è´¹ç”¨è¡¨æ ¼

**å®ç°æ–¹å¼**:
```tsx
import dynamic from 'next/dynamic';
const TrendChart = dynamic(() => import('@/app/dashboard/components/TrendChart'), {
  loading: () => <ChartSkeleton height={400} />,
  ssr: false
});
```

**æ‰§è¡Œæ­¥éª¤**:
1. âœ… æ›´æ–° `globals.css` åˆ›å»ºç»ç’ƒæ•ˆæœæ ·å¼
2. âœ… åˆ›å»º Skeleton ç»„ä»¶ç³»åˆ—
3. âœ… ä» `app/page.tsx` æå–å›¾è¡¨åˆ°ç‹¬ç«‹æ–‡ä»¶
4. âœ… å®ç° `next/dynamic` æ‡’åŠ è½½
5. âœ… åº”ç”¨ç»ç’ƒæ ·å¼åˆ° Sidebarã€MobileNav å’Œå¡ç‰‡
6. âœ… åŒæ ·ä¼˜åŒ– `app/explore/page.tsx`

---

## ğŸ”· é˜¶æ®µ 2ï¼šç°ä»£åŒ–æ¶æ„ï¼ˆServer Componentsï¼‰

**ç›®æ ‡**: åˆ©ç”¨ Next.js 16 Server Components å®ç°å¹¶è¡Œæ•°æ®è·å–å’Œæ›´å¿«çš„ FCP

### 2.1 æ¶æ„é‡è®¾è®¡

**å½“å‰æ¶æ„**:
```
Client (app/page.tsx) â†’ useEffect â†’ Fetch /api/overview â†’ Render
```

**ç›®æ ‡æ¶æ„**:
```
Server Page (app/page.tsx) â†’ å¹¶è¡Œ DB è°ƒç”¨ â†’ ä¼ é€’æ•°æ®åˆ° Client Components
```

**æ–°ç»“æ„**:
```
app/page.tsx (Server Component)
  â”œâ”€â”€ <DashboardHeader /> (Client - æ—¥æœŸé€‰æ‹©å™¨ & ç­›é€‰å™¨)
  â”œâ”€â”€ <Suspense fallback={<StatsGridSkeleton />}>
  â”‚     <StatsOverview /> (Server - è·å–ç»Ÿè®¡æ•°æ®)
  â””â”€â”€ <Suspense fallback={<ChartsSkeleton />}>
        <UsageCharts /> (Server - è·å–å›¾è¡¨æ•°æ®)
```

### 2.2 ç»„ä»¶æ¨¡å—åŒ–ä¸æ•°æ®æµ

**æ–°å¢æ•°æ®å±‚** (`lib/data/`):
- `lib/data/dashboard.ts` - ç›´æ¥ DB æŸ¥è¯¢ï¼ˆDrizzleï¼‰ï¼Œæ›¿ä»£ `/api/overview` é€»è¾‘

**é‡æ„ç»„ä»¶**:
- `app/page.tsx` - æˆä¸ºç¼–æ’å™¨ï¼ˆServer Componentï¼‰
- `app/dashboard/components/DashboardClient.tsx` - ä¿å­˜å¿…é¡»å…¨å±€çš„çŠ¶æ€
- **çŠ¶æ€ç®¡ç†**: æ—¥æœŸèŒƒå›´è¿ç§»åˆ° URL Search Params (`?from=...&to=...`)

### 2.3 é«˜çº§è§†è§‰æ•ˆæœï¼ˆMotion & ä¹è§‚ UIï¼‰

**ä¾èµ–åº“**: `framer-motion`

**åŠŸèƒ½**:
- é¡µé¢è¿‡æ¸¡ï¼šä¸»å†…å®¹æ·¡å…¥/ä¸Šæ»‘
- äº¤é”™å…¥åœºï¼šç»Ÿè®¡å¡ç‰‡é€ä¸ªå¼¹å‡º
- ä¹è§‚ UIï¼šSidebar å¼€å…³ç«‹å³æ›´æ–°è§†è§‰ï¼Œè¯·æ±‚å¤±è´¥æ—¶å›æ»š

**æ‰§è¡Œæ­¥éª¤**:
1. â³ å®‰è£… `framer-motion` ä¾èµ–
2. â³ çŠ¶æ€æå‡ï¼šå°† `rangeSelection` è¿ç§»åˆ° URL Search Params
3. â³ æ•°æ®åº“ï¼šä» `app/api/overview/route.ts` æå–é€»è¾‘åˆ° `lib/data/overview.ts`
4. â³ Server Pageï¼šé‡å†™ `app/page.tsx` ä¸º `async function Page({ searchParams })`
5. â³ Streamingï¼šç”¨ `<Suspense>` åŒ…è£¹é‡å‹éƒ¨åˆ†
6. â³ Motionï¼šç”¨ `<motion.div>` åŒ…è£¹åˆ—è¡¨é¡¹å®ç°å…¥åœºåŠ¨ç”»
7. â³ ä¹è§‚ UIï¼šä¼˜åŒ– Sidebar å¼€å…³äº¤äº’

---

## ğŸ› ï¸ æŠ€æœ¯å†³ç­–

### ä¾èµ–é¡¹
- **`framer-motion`** - React åŠ¨ç”»è¡Œä¸šæ ‡å‡†
- **`clsx` & `tailwind-merge`** - å¥å£®çš„å¯å¤ç”¨ç»„ä»¶ï¼ˆå¦‚æœªå®‰è£…éœ€æ·»åŠ ï¼‰
- **`lucide-react`** - ç»§ç»­ä½¿ç”¨ä»¥ä¿æŒå›¾æ ‡ä¸€è‡´æ€§

### CSS å˜é‡ vs Tailwind å·¥å…·ç±»
ä½¿ç”¨ **CSS å˜é‡**ï¼ˆTailwind 4 `@theme` æˆ– `:root`ï¼‰å®šä¹‰é¢œè‰²ï¼Œæ”¯æŒè¿è¡Œæ—¶ä¸»é¢˜åˆ‡æ¢ï¼Œç®€åŒ– Tailwind ç±»åã€‚

### å…¼å®¹æ€§
- **React 19**: å®Œå…¨å…¼å®¹ï¼Œå¯ä½¿ç”¨ `use()` hook
- **Recharts**: ä¸¥æ ¼å®¢æˆ·ç«¯ï¼Œ`next/dynamic` å¿…é¡»è®¾ç½® `ssr: false`

### æ€§èƒ½ç­–ç•¥
1. **LCP**: ä½¿ç”¨ Skeletonï¼ˆé˜¶æ®µ 1ï¼‰å’Œ Streamingï¼ˆé˜¶æ®µ 2ï¼‰æœ€å°åŒ–åŠ è½½æ—¶é—´
2. **CLS**: `ChartSkeleton` å®šä¹‰æ˜ç¡®é«˜åº¦åŒ¹é… Recharts å®½é«˜æ¯”

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### é˜¶æ®µ 1 æ–°å¢
- `app/components/ui/Skeleton.tsx`
- `app/components/ui/CardSkeleton.tsx`
- `app/components/ui/ChartSkeleton.tsx`
- `app/dashboard/components/TrendChart.tsx`
- `app/dashboard/components/HourlyBarChart.tsx`
- `app/dashboard/components/ModelDistributionPie.tsx`
- `app/dashboard/components/CostTable.tsx`

### é˜¶æ®µ 1 ä¿®æ”¹
- `app/globals.css`
- `app/layout.tsx`
- `app/components/Sidebar.tsx`
- `app/components/MobileNav.tsx`
- `app/dashboard/components/StatsCard.tsx`
- `app/page.tsx`
- `app/explore/page.tsx`

### é˜¶æ®µ 2 æ–°å¢
- `lib/data/dashboard.ts`
- `lib/data/overview.ts`
- `app/dashboard/components/DashboardClient.tsx`

### é˜¶æ®µ 2 ä¿®æ”¹
- `app/page.tsx` (é‡å†™ä¸º Server Component)
- `package.json` (æ·»åŠ  `framer-motion`)

---

## é¢„æœŸæ•ˆæœ

### é˜¶æ®µ 1
- è§†è§‰æå‡ 40%
- æ„ŸçŸ¥æ€§èƒ½æå‡ 30%
- åˆå§‹ JS bundle å‡å°‘ 25%

### é˜¶æ®µ 2
- é¦–å±åŠ è½½æå‡ 50%+
- FCP æ”¹å–„ 40%
- æ¶æ„å¯ç»´æŠ¤æ€§å¤§å¹…æå‡

---

## Gemini ä¼šè¯ ID
`dab2680e-592c-4f0d-b262-ca8174038c40`
