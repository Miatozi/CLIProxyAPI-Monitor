# CLIProxyAPI-Monitor 项目调优 - 完整优化方案

## 执行时间
2026-01-15

## 目标
对整个项目进行全面优化，重点提升前端性能和用户体验，同时优化后端 API 性能和数据库查询效率。

## 方案选择
**方案 3**：完整优化（Phase 1 + 2 + 3）

---

## Phase 1：基础设施与移动端（P0 - 立即执行）

### 后端基础设施
- ✅ CDN 缓存头（`app/api/overview/route.ts`、`app/api/explore/route.ts`）
- ✅ 构建去副作用（`package.json`）
- ✅ 迁移流水线（`.github/workflows/db-migrate.yml`）
- ✅ 索引补齐（`scripts/migrate.mjs`）

### 前端移动响应式
- ✅ 字体优化（`app/layout.tsx`）
- ✅ 移动端导航（`app/components/MobileNav.tsx`）
- ✅ Sidebar 响应式（`app/components/Sidebar.tsx`）
- ✅ ClientLayout 响应式（`app/components/ClientLayout.tsx`）

---

## Phase 2：组件重构与性能优化（P1 - 1周内）

### 前端组件原子化
- 拆分 Dashboard（`app/dashboard/components/`）
- Recharts 懒加载（`next/dynamic`）

### 后端采样优化
- Explore 时间桶采样（`lib/queries/explore.ts`）

---

## Phase 3：Server Components 与预聚合（P2 - 2周内）

### 前端 Server Components
- 重构 `app/page.tsx` 为 Server Component
- 创建 `DashboardClient.tsx`

### 后端预聚合表
- Schema 设计（`usageHourlyAgg`、`usageDailyAgg`）
- 预聚合读路径（`lib/queries/overviewAgg.ts`）
- 预聚合写路径（`app/api/sync/route.ts`）

---

## 技术栈
- Next.js 16 (App Router)
- React 19
- TailwindCSS
- Drizzle ORM
- PostgreSQL
- Vercel 部署

## 预期效果
- 移动端可用 ✅
- API 缓存命中率提升 50%+
- 首屏 LCP 下降 30%+
- 数据量增长不影响查询性能
